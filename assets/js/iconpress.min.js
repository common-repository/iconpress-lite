!function(c){"use strict";c.IconPressApp=new function(){var s=this;this.panel=[],this.instanceId=!1,this.context=!1,s.init=function(e,n){var t=c(document);this.instanceId=e,this.context=n,this.template_html=c("#tmpl-iconpress-panel").html(),_.isUndefined(this.template_html)?console.log("Panel's markup is not loaded."):(void 0===this.panel[this.instanceId]&&this.makePanel(),this.initEvents(t),this.addShortcodeToEditor())},s.makePanel=function(){var e=_.template(this.template_html);c("body").append(e({instance_id:this.instanceId})),this.panel[this.instanceId]=c("#ip-insertPanel-"+this.instanceId),c("<iframe>",{src:iconPressAppConfig.panel_url+"&context="+this.context,frameborder:0}).appendTo(s.panel[this.instanceId].children(".ip-insertPanel-inner"))},s.initEvents=function(e){this.openIconPress(),c(".ip-insertPanel-close, .ip-insertPanel-overlay",s.panel[this.instanceId]).on("click",function(e){e.preventDefault(),s.closeIconPress()}),c(window).one("iconpress:save iconpress:delete",function(e){s.resetSvgContents();var n=[c("#customize-preview iframe"),c("#vc_inline-frame"),c("#elementor-preview-iframe")];c.each(n,function(e,n){0!==c(n).length&&s.resetSvgContents(c(n)[0].contentDocument)})})},s.openIconPress=function(){this.panel[this.instanceId].addClass("is-visible")},s.closeIconPress=function(){this.panel[this.instanceId].removeClass("is-visible")},s.addShortcodeToEditor=function(){c(window).one("iconpress:select:wpeditor",function(e){e.preventDefault();var n=e.detail;s.instanceId==n.instance_id&&(s.sendToEditor(n.shortcode,n.instance_id),s.closeIconPress())})},s.insertAtChars=function(e,n){var t=void 0!==e[0].name?e[0]:e;return t.value.length&&void 0!==t.selectionStart?(t.focus(),t.value.substring(0,t.selectionStart)+n+t.value.substring(t.selectionEnd,t.value.length)):(t.focus(),n)},s.sendToEditor=function(e,n){var t,i=window.parent;if(void 0!==i.tinymce&&(t=i.tinymce.get(n)),t&&!t.isHidden())t.execCommand("mceInsertContent",!1,e);else{var o=c("#"+n,i.document);o.val(s.insertAtChars(o,e)).trigger("change")}},s.resetSvgContents=function(i){i=i||document,c.ajax({url:iconPressAppConfig.rest_url+"get_svg_sprite_content",method:"GET",cache:!1,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",iconPressAppConfig.nonce_rest)},success:function(e){var n=i.getElementById("iconpress_svg_sprite");if(n&&e.success&&e.data){var t=i.createElement("div");t.innerHTML=e.data,n.innerHTML=t.childNodes[0].innerHTML}else console.error("Couldn't reload svg sprite.")}})}},c(function(){1==iconPressAppConfig.insert_icon_button&&c(document).on("tinymce-editor-init",function(e,n){var t=c('<a href="#" class="button ip-wpEditor-insert" data-instance-id="'+n.id+'"><svg class="iconpress-icon iconpress-icon-iconpress-logo " aria-hidden="true" style="font-size: 18px; margin-right: 5px;" role="img"> <use href="#iconpress-logo" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#iconpress-logo"></use> </svg><span>'+iconPressAppConfig.translations.INSERT_ICON+"</span></a>"),i=c(n.container).closest(".wp-editor-wrap");t.appendTo(i.find(".wp-media-buttons"))}),c("body").on("click",".ip-wpEditor-insert",function(e){e.preventDefault();var n=c(e.currentTarget).attr("data-instance-id");c.IconPressApp.init(n,"wpeditor")});var e=c(".iconpress-notice-close-button");e&&0<e.length&&e.on("click",function(e){window.location.href=document.URL+"&iconpress_delete_notices=1&"+iconPressAppConfig.nonce_name+"="+iconPressAppConfig.nonce_value}),c(".js-ip-passToggle").each(function(e,n){var t=c(n);t.find('input[type="checkbox"]').on("change",function(e){t.find(".ip-passToggle-field").attr("type",c(e.currentTarget).prop("checked")?"text":"password")})}),c("#ip-refreshCache").on("click",function(e){if(e.preventDefault(),void 0!==iconPressConfig.plugin_slug){localStorage.removeItem(iconPressConfig.plugin_slug+"_myCollection");var n=iconPressConfig.panes;n&&0!==n.length&&c.each(n,function(e,n){var t=n.type;localStorage.removeItem(iconPressConfig.plugin_slug+"_filter_"+t),localStorage.removeItem(iconPressConfig.plugin_slug+"_collections_"+t+"_0"),localStorage.removeItem(iconPressConfig.plugin_slug+"_collections_"+t+"_1"),localStorage.removeItem(iconPressConfig.plugin_slug+"_collections_"+t+"_all"),localStorage.removeItem(iconPressConfig.plugin_slug+"_total_collections_"+t+"_0"),localStorage.removeItem(iconPressConfig.plugin_slug+"_total_collections_"+t+"_1"),localStorage.removeItem(iconPressConfig.plugin_slug+"_total_collections_"+t+"_all"),localStorage.removeItem(iconPressConfig.plugin_slug+"_search_"+t)}),window.location.reload()}})})}(jQuery);