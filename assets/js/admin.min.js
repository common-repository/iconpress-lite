!function(r){r(document).ready(function(){r(".ip-colorField").wpColorPicker(),r(".js-options-export-backup").on("click",function(e){e.preventDefault();var t=r(e.currentTarget);t.next().addClass("is-active"),t.attr("disabled","disabled"),r.ajax({url:iconPressOptionsConfig.export_url,method:"GET",cache:!1,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",iconPressOptionsConfig.nonce_rest)},success:function(e){if(e&&e.success){location.href=e.data;var o=e.data.split("/").reverse()[0];r.ajax({url:iconPressOptionsConfig.delete_export_url,method:"GET",cache:!1,timeout:1e4,data:{filename:o},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",iconPressOptionsConfig.nonce_rest)},success:function(e){t.removeAttr("disabled"),t.next().removeClass("is-active")}})}}})}),r(".js-options-import-backup").on("click",function(e){e.preventDefault();var s,n=r(e.currentTarget),o=n.next('input[type="file"]'),i=n.closest("fieldset"),a=function(e,o){var t=r('<div class="ip-noticeComp ip-noticeComp--'+o+'">'+e+"</div>");i.prepend(t),setTimeout(function(){t.fadeOut("fast",function(){t.remove()})},3e3)},l=function(){n.siblings(".spinner").removeClass("is-active"),n.removeAttr("disabled"),o.val("")};o.trigger("click"),o.one("change",function(e){var o=void 0===(s=r(e.currentTarget).prop("files"))[0]?null:s[0];if(null!==o)if("application/zip"===o.type||"application/x-zip-compressed"===o.type){n.siblings(".spinner").addClass("is-active"),n.attr("disabled","disabled");var t=new FormData(n.closest("form"));t.append("file",o),t.append("overwrite",r("#overwrite_import").prop("checked")),r.ajax({url:iconPressOptionsConfig.import_url,method:"POST",cache:!1,processData:!1,contentType:!1,data:t,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",iconPressOptionsConfig.nonce_rest)},success:function(e){e&&e.data&&a(e.data,"success"),l(),localStorage.removeItem(iconPressOptionsConfig.plugin_slug+"_myCollection")},error:function(e){var o="Something went wrong: ";e&&e.responseJSON&&(o+=" Message: "+e.responseJSON.message),a(o,"error"),l()}})}else a("Not a zip! Please select a .zip file. Found type: "+o.type,"error");else a("Not a zip! Please select a .zip file.","error")})}),r(".js-btn-uploadSvgFiles").on("click",function(e){e.preventDefault(),r(".ip-uploadSvgFiles").toggleClass("is-hidden")}),"undefined"!=typeof Dropzone&&(Dropzone.options.jsUploadSvgImage={paramName:"file",maxFilesize:1,acceptedFiles:"image/svg+xml",maxFiles:10,uploadMultiple:!0,success:function(e,o){if(e.xhr.response){var t=JSON.parse(e.xhr.response);t.success?(r('<li><img src="'+e.dataURL+'"><span data-id="'+t.data+'" class="ip-uploadedSvgs-delete">&times;</span></li>').appendTo("#uploadedSvgs"),r("#uploadedSvgs").removeClass("is-empty")):(r(e.previewTemplate).find(".dz-error-message").show().find("span").text(t.data),console.log("Failed upload: "+t.data))}localStorage.removeItem(iconPressOptionsConfig.plugin_slug+"_myCollection")}}),r("#js-uploadMediaLibrary").on("change",function(e){r("#js-upload-svg-image").find('input[name="uploadml"]').val(r(this).prop("checked")?1:0)}),r("body").on("click",".ip-uploadedSvgs-delete",function(e){e.preventDefault();var o=r(e.currentTarget);r.ajax({url:iconPressOptionsConfig.delete_icon_url,method:"POST",cache:!1,data:{internal_id:o.attr("data-id")},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",iconPressOptionsConfig.nonce_rest)},success:function(e){e.success&&o.closest("li").fadeOut("fast",function(){r(this).remove(),r("#uploadedSvgs li").length||r("#uploadedSvgs").addClass("is-empty"),localStorage.removeItem(iconPressOptionsConfig.plugin_slug+"_myCollection")})}})}),r("#js-rescanCollections").on("click",function(e){e.preventDefault();var o=iconPressOptionsConfig.plugin_slug;localStorage.removeItem(o+"_filter_local"),localStorage.removeItem(o+"_collections_local_0"),localStorage.removeItem(o+"_collections_local_1"),localStorage.removeItem(o+"_collections_local_all"),localStorage.removeItem(o+"_total_collections_local_0"),localStorage.removeItem(o+"_total_collections_local_1"),localStorage.removeItem(o+"_total_collections_local_all"),window.location.href=e.currentTarget.href})})}(jQuery);